---
// Componente Navigation - Barra de navegación rediseñada para Mobile (Bottom Bar)
---

<!-- Desktop Navigation -->
<nav class="fixed top-0 left-0 right-0 z-50 px-6 py-4 hidden md:block" id="navbar-desktop">
    <div class="max-w-7xl mx-auto flex items-center justify-center">
        <div class="rounded-full flex items-center gap-8 px-8 py-3 transition-all duration-500 border border-white/0 bg-white/0" id="nav-pill">
            <a href="#home" class="text-gray-300 hover:text-[#FFD700] transition-colors font-medium tracking-wide relative group">
                Inicio
                <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-[#FFD700] transition-all duration-300 group-hover:w-full"></span>
            </a>
            <a href="#about" class="text-gray-300 hover:text-[#FFD700] transition-colors font-medium tracking-wide relative group">
                Sobre mí
                <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-[#FFD700] transition-all duration-300 group-hover:w-full"></span>
            </a>
            <a href="#portfolio" class="text-gray-300 hover:text-[#FFD700] transition-colors font-medium tracking-wide relative group">
                Portafolio
                <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-[#FFD700] transition-all duration-300 group-hover:w-full"></span>
            </a>
            <a href="#experience" class="text-gray-300 hover:text-[#FFD700] transition-colors font-medium tracking-wide relative group">
                Experiencia
                <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-[#FFD700] transition-all duration-300 group-hover:w-full"></span>
            </a>
            <a href="#skills" class="text-gray-300 hover:text-[#FFD700] transition-colors font-medium tracking-wide relative group">
                Tecnologías
                <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-[#FFD700] transition-all duration-300 group-hover:w-full"></span>
            </a>
            <a href="#contact" class="text-gray-300 hover:text-[#FFD700] transition-colors font-medium tracking-wide relative group">
                Contacto
                <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-[#FFD700] transition-all duration-300 group-hover:w-full"></span>
            </a>
        </div>
    </div>
</nav>

<!-- Mobile Floating Bottom Navigation -->
<nav class="fixed bottom-6 left-1/2 -translate-x-1/2 z-100 w-[90%] max-w-sm md:hidden" id="mobile-nav">
    <div class="bg-[#1a1a1a]/80 backdrop-blur-xl border border-white/10 rounded-4xl px-4 py-3 shadow-[0_20px_40px_rgba(0,0,0,0.4)] flex items-center justify-around">
        {
            [
                { id: 'home', label: 'Inicio', href: '#home', icon: 'M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6' },
                { id: 'about', label: 'Yo', href: '#about', icon: 'M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z' },
                { id: 'portfolio', label: 'Proyectos', href: '#portfolio', icon: 'M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z' },
                { id: 'experience', label: 'Exp', href: '#experience', icon: 'M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745V20a2 2 0 002 2h14a2 2 0 002-2v-6.745zM16 8V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v3h8z' },
                { id: 'contact', label: 'Email', href: '#contact', icon: 'M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z' }
            ].map((item) => (
                <a
                    href={item.href}
                    class="mobile-nav-item relative flex items-center justify-center transition-all duration-500 ease-[cubic-bezier(0.23,1,0.32,1)] px-3 py-2 rounded-2xl group"
                    data-id={item.id}
                >
                    <div class="relative z-10 flex items-center gap-2">
                        <svg class="w-6 h-6 text-white/40 group-[.active]:text-black transition-colors duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d={item.icon} />
                        </svg>
                        <span class="text-black text-xs font-bold hidden group-[.active]:block whitespace-nowrap overflow-hidden animate-in fade-in slide-in-from-left-2 transition-all duration-300">
                            {item.label}
                        </span>
                    </div>
                    <!-- Background Pill for Active State -->
                    <div class="absolute inset-0 bg-white scale-0 opacity-0 group-[.active]:scale-100 group-[.active]:opacity-100 rounded-2xl transition-all duration-500 ease-[cubic-bezier(0.23,1,0.32,1)]" />
                </a>
            ))
        }
    </div>
</nav>

<style>
    /* Desktop Animations */
    @keyframes navSlideDown {
        from { opacity: 0; transform: translateY(-20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    #nav-pill {
        animation: navSlideDown 1s ease-out forwards;
        animation-delay: 0.2s;
    }

    /* Active Item Styles (managed by JS) */
    .mobile-nav-item.active {
        background-color: transparent;
    }

    /* Shadow for active state background */
    .mobile-nav-item.active div[class*="absolute"] {
        box-shadow: 0 4px 12px rgba(255, 255, 255, 0.2);
    }
</style>

<script>
    const desktopNav = document.getElementById("navbar-desktop");
    const mobileNavItems = document.querySelectorAll(".mobile-nav-item");
    const sections = document.querySelectorAll("section");
    let isScrollingManual = false;

    // Scroll Effect for Desktop Nav
    window.addEventListener("scroll", () => {
        const pill = document.getElementById("nav-pill");
        if (window.scrollY > 50) {
            pill?.classList.add("bg-white/5", "border-white/10", "backdrop-blur-xl");
            pill?.classList.remove("border-white/0", "bg-white/0");
        } else {
            pill?.classList.remove("bg-white/5", "border-white/10", "backdrop-blur-xl");
            pill?.classList.add("border-white/0", "bg-white/0");
        }
    });

    // Intersection Observer for Active State in Mobile Nav
    const observerOptions = {
        root: null,
        rootMargin: '-30% 0px -30% 0px',
        threshold: [0, 0.1, 0.5]
    };

    const updateActiveItem = (id: string | null) => {
        if (!id) return;
        mobileNavItems.forEach(item => {
            if (item.getAttribute('href') === `#${id}`) {
                item.classList.add('active');
            } else {
                item.classList.remove('active');
            }
        });
    };

    const observer = new IntersectionObserver((entries) => {
        if (isScrollingManual) return;

        // Encontrar la sección con mayor intersección que esté activa
        const intersectingEntries = entries.filter(e => e.isIntersecting);
        if (intersectingEntries.length > 0) {
            // Ordenamos por mayor ratio de intersección para evitar saltos raros
            const mostVisible = intersectingEntries.reduce((prev, current) => 
                (prev.intersectionRatio > current.intersectionRatio) ? prev : current
            );
            updateActiveItem(mostVisible.target.id);
        }
    }, observerOptions);

    sections.forEach(section => observer.observe(section));

    // Manual click handling
    mobileNavItems.forEach(item => {
        item.addEventListener('click', (e) => {
            isScrollingManual = true;
            const href = item.getAttribute('href');
            if (!href) return;
            
            // Actualizar UI inmediatamente
            mobileNavItems.forEach(i => i.classList.remove('active'));
            item.classList.add('active');
            
            // Haptic/Click feedback feel
            (item as HTMLElement).style.transform = "scale(0.9)";
            setTimeout(() => (item as HTMLElement).style.transform = "scale(1)", 150);

            // Liberar el scroll manual después de que la navegación smooth termine
            setTimeout(() => {
                isScrollingManual = false;
            }, 1000); 
        });
    });
</script>

